# 掘金自动签到&抽奖插件

一个功能强大的浏览器插件，用于自动在掘金网站进行每日签到和抽奖，支持定时任务和飞书消息推送。

## 📋 项目简介

这是一个基于 WXT 框架开发的浏览器插件，能够自动完成掘金网站的每日签到和抽奖任务。插件支持自定义执行时间、随机延迟执行、飞书消息推送等功能，让你再也不用担心忘记签到！

## ✨ 主要功能

### 1. 自动签到

- 自动在掘金首页或签到页面执行签到操作
- 智能识别页面状态，避免重复签到
- 支持页面跳转和刷新后的自动重试

### 2. 自动抽奖

- 签到成功后自动执行抽奖
- 支持多次抽奖（如果可用）
- 智能检测抽奖状态，避免重复操作

### 3. 定时任务

- 支持设置每日执行时间（默认 09:00）
- 自动添加 0-30 分钟随机延迟，模拟人工操作
- 使用 Chrome Alarms API 实现可靠的定时任务

### 4. 飞书消息推送

- 支持将签到和抽奖结果推送到飞书机器人
- 详细的结果报告，包括：
  - 签到状态（成功/失败）
  - 抽奖结果
  - 连续签到天数
  - 累计签到天数
  - 当前矿石数
  - 失败原因（如果失败）

### 5. 立即测试

- 支持手动触发签到和抽奖操作
- 方便测试和调试

## 🛠️ 技术栈

- **框架**: [WXT](https://wxt.dev/) - 现代化的浏览器插件开发框架
- **前端**: React 19 + TypeScript
- **UI 组件**: Ant Design 6
- **样式**: Tailwind CSS 4
- **时间处理**: dayjs
- **构建工具**: Vite (由 WXT 集成)

## 📦 项目结构

```
demo/
├── entrypoints/              # 插件入口文件
│   ├── background.ts        # 后台脚本（处理定时任务和消息传递）
│   ├── content.ts           # 内容脚本（在掘金页面执行签到和抽奖）
│   ├── popup/               # 弹出窗口界面
│   │   ├── App.tsx          # 主组件
│   │   ├── main.tsx         # React 入口
│   │   ├── index.html       # HTML 模板
│   │   └── index.css        # 样式文件
│   └── utils/               # 工具函数
│       └── feishu.ts        # 飞书消息推送工具
├── public/                  # 静态资源
│   └── icon/               # 插件图标
├── types/                   # TypeScript 类型定义
├── wxt.config.ts           # WXT 配置文件
├── package.json            # 项目依赖
└── tsconfig.json           # TypeScript 配置
```

## 🚀 快速开始

### 环境要求

- Node.js >= 18
- pnpm >= 8 (推荐) 或 npm / yarn

### 安装依赖

```bash
# 使用 pnpm (推荐)
pnpm install

# 或使用 npm
npm install

# 或使用 yarn
yarn install
```

### 开发模式

```bash
# Chrome 浏览器开发模式
pnpm dev

# Firefox 浏览器开发模式
pnpm dev:firefox
```

开发模式会自动打开浏览器并加载插件，支持热重载。

### 构建插件

```bash
# 构建 Chrome 版本（生成 zip 文件）
pnpm build
# 或
pnpm zip

# 构建 Firefox 版本
pnpm build:firefox
# 或
pnpm zip:firefox
```

构建完成后，zip 文件会生成在 `.output` 目录下。

### 类型检查

```bash
pnpm compile
```

## 📖 使用说明

### 1. 安装插件

1. 构建插件（见上方构建步骤）
2. 打开 Chrome 浏览器，访问 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目的 `.output` 目录（或解压后的 zip 文件）

### 2. 配置插件

1. 点击浏览器工具栏中的插件图标，打开设置界面
2. 设置每日执行时间（例如：09:00）
3. 开启"启用自动签到"开关
4. （可选）配置飞书消息推送：
   - 开启"推送到飞书"开关
   - 填写飞书机器人 Webhook 链接
   - 点击"保存设置"

### 3. 获取飞书 Webhook

1. 在飞书群聊中添加"自定义机器人"
2. 复制生成的 Webhook URL
3. Webhook URL 格式：`https://open.feishu.cn/open-apis/bot/v2/hook/...`
4. 将 URL 粘贴到插件设置中

### 4. 测试功能

点击"立即测试"按钮，插件会立即执行一次签到和抽奖操作，方便验证功能是否正常。

## ⚙️ 配置说明

### 执行时间设置

- **基础时间**: 你选择的时间（例如：09:00）
- **实际执行时间**: 基础时间 + 随机延迟（0-30 分钟）
- **示例**: 如果选择 09:00，实际执行时间会在 09:00 - 09:30 之间随机

这样设计是为了：

- 模拟人工操作，避免固定时间执行
- 降低被系统识别为自动化的风险

### 存储设置

插件使用 Chrome Storage Sync API 存储设置，会在你的所有设备间同步：

- `checkinTime`: 签到时间（格式：HH:mm）
- `checkinEnabled`: 是否启用自动签到
- `feishuEnabled`: 是否启用飞书推送
- `feishuWebhook`: 飞书 Webhook URL

## 🔧 工作原理

### 1. 定时任务流程

```
Background Script (background.ts)
  ↓
设置 Chrome Alarms 定时任务
  ↓
定时任务触发
  ↓
打开/激活掘金标签页
  ↓
发送消息给 Content Script
  ↓
Content Script (content.ts)
  ↓
执行签到 → 执行抽奖 → 发送飞书通知
```

### 2. 签到流程

1. **首页签到**:

   - 在掘金首页查找签到按钮（`button.btn.signin-btn`）
   - 点击按钮，跳转到签到页面

2. **签到页面**:

   - 检测是否已签到（`button.signedin.btn`）
   - 如果未签到，点击签到按钮（`button.signin.btn`）
   - 等待签到完成，刷新页面

3. **抽奖**:
   - 签到成功后，跳转到抽奖页面
   - 查找并点击抽奖按钮
   - 支持多次抽奖（如果可用）

### 3. 消息推送

- 签到和抽奖完成后，如果启用了飞书推送，会将结果发送到飞书机器人
- 消息包含详细的执行结果和统计数据

## 🐛 故障排除

### 问题：插件无法执行签到

**可能原因**:

1. 未打开掘金网站
2. 页面未完全加载
3. 掘金网站更新了页面结构

**解决方法**:

1. 确保已打开掘金网站（https://juejin.cn）
2. 点击"立即测试"按钮，查看控制台日志
3. 检查浏览器控制台（F12）中的错误信息

### 问题：飞书消息推送失败

**可能原因**:

1. Webhook URL 格式不正确
2. 飞书机器人已被删除或失效
3. 网络连接问题

**解决方法**:

1. 检查 Webhook URL 格式是否正确
2. 在飞书中重新创建机器人并获取新的 Webhook URL
3. 检查网络连接

### 问题：定时任务不执行

**可能原因**:

1. 插件被禁用
2. 浏览器关闭或休眠
3. Chrome Alarms 被清除

**解决方法**:

1. 确保插件已启用
2. 保持浏览器运行（可以最小化）
3. 重新保存设置，重新设置定时任务

## 📝 开发说明

### 代码结构

- **background.ts**: 后台脚本，负责定时任务管理和消息传递
- **content.ts**: 内容脚本，在掘金页面执行实际的签到和抽奖操作
- **popup/App.tsx**: 弹出窗口界面，处理用户设置和交互
- **utils/feishu.ts**: 飞书消息推送工具函数

### 添加新功能

1. 在相应的入口文件中添加代码
2. 如需新的权限，在 `wxt.config.ts` 的 `manifest.permissions` 中添加
3. 运行 `pnpm compile` 检查类型错误
4. 测试新功能

### 调试技巧

1. **Background Script 调试**:

   - 访问 `chrome://extensions/`
   - 找到插件，点击"service worker"或"背景页"
   - 打开开发者工具查看日志

2. **Content Script 调试**:

   - 在掘金页面按 F12 打开开发者工具
   - 在 Console 标签中查看日志

3. **Popup 调试**:
   - 右键点击插件图标，选择"检查弹出内容"
   - 打开开发者工具查看日志

## 📄 许可证

本项目为私有项目。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## ⚠️ 免责声明

本插件仅供学习交流使用，请遵守掘金网站的使用条款。使用本插件产生的任何后果由使用者自行承担。

## 📞 联系方式

如有问题或建议，请通过 Issue 反馈。

---

**祝您使用愉快！每天自动签到，再也不用担心忘记啦！** 🎉
